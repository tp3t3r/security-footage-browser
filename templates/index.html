<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // Auto-refresh every 30 seconds
        let refreshInterval = setInterval(() => {
            location.reload();
        }, 30000);
        
        // Stop auto-refresh when video is playing
        document.addEventListener('DOMContentLoaded', () => {
            const videos = document.querySelectorAll('video');
            videos.forEach(video => {
                video.addEventListener('play', () => {
                    clearInterval(refreshInterval);
                });
                video.addEventListener('pause', () => {
                    refreshInterval = setInterval(() => location.reload(), 30000);
                });
            });
        });
    </script>
</head>
<body>
    <h1>{{ title }}</h1>
    
    <div class="metadata">
        <p>Cache: {{ cache_size }} | <span id="last-update">Last update: just now</span></p>
        {% for cam in cameras %}
        <p>{{ cam.name }} - Last recording: {{ last_recordings.get(cam.id, 'N/A') }}</p>
        {% endfor %}
    </div>
    
    <div class="tabs">
        {% for cam in cameras %}
        <a href="/?camera={{ cam.id }}" class="tab {% if selected_camera == cam.id %}active{% endif %}">{{ cam.name }}</a>
        {% endfor %}
    </div>
    
    {% for day, segments in days %}
    <div class="day">
        <h2>{{ day }} ({{ segments|length }} recordings)</h2>
        {% for seg in segments %}
        <div class="segment">
            <p>
                File: hiv{{ '%05d'|format(seg.file) }}.mp4 - {{ seg.start_time_str }} ({{ seg.size }})
                <a href="/video?camera_id={{ seg.camera_id }}&file={{ seg.file }}&segment={{ seg.segment }}" download="hiv{{ '%05d'|format(seg.file) }}.mp4" class="download-btn">Download</a>
            </p>
            <video controls>
                <source src="/video?camera_id={{ seg.camera_id }}&file={{ seg.file }}&segment={{ seg.segment }}" type="video/mp4">
            </video>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</body>
</html>
